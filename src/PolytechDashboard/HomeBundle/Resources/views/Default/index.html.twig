{% extends 'PolytechDashboardHomeBundle:Default:base.html.twig' %}


{%  block title %}
    Dashboard Polytech'Paris-Sud
{% endblock %}

{% block body %}
    <div class="wrapper">

        <!-- PARTIE DU HAUT -->
        <header class="main-header">
            <!-- Logo -->
            <a href="#" onclick="activateTag('main_dashboard')" class="logo"><b>myDashboard</b></a>           <!-- LOGO EN HAUT A GAUCHE -->
            <!-- Header Navbar: style can be found in header.less -->
            <nav class="navbar navbar-static-top" role="navigation">
                <!-- Sidebar toggle button-->
                <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
                    <span class="sr-only">Toggle navigation</span>
                </a>

                <!-- BARRE DE NAVIGATION EN HAUT -->
                <div class="navbar-custom-menu">
                    <ul class="nav navbar-nav">


                        <!-- Notifications: style can be found in dropdown.less -->
                        <li class="dropdown notifications-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <i class="fa fa-bell-o"></i>
                                <span id="nbNotification" class="label label-warning"></span>
                            </a>
                            <ul class="dropdown-menu">
                                <li id="textNbNotification" class="header">Vous n'avez pas de nouveaux notifications</li>
                                <li>
                                    <!-- inner menu: contains the actual data -->
                                    <div id="NotificationContainer">


                                    </div>

                                </li>
                                <!--<li class="footer"><a href="#">View all</a></li>-->
                            </ul>
                        </li>
                        <!-- COMPTE DE L'UTILISATEUR -->
                        <li class="dropdown user user-menu">
                            <!-- APERCU DE L'UTILISATEUR -->
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <img src="{{ asset('dist/img/user2-160x160.jpg')}}" class="user-image" alt="User Image"/>
                                <span class="hidden-xs"> {{prenom}} {{nom}}</span>
                            </a>
                            <ul class="dropdown-menu">
                                <!-- IMAGE DE L'UTILISATEUR -->
                                <li class="user-header">
                                    <img src="{{ asset('dist/img/user2-160x160.jpg')}}" class="img-circle" alt="User Image" />
                                    <p>
                                        {{prenom}} {{nom}}
                                        <small>ET4 - Informatique</small>   <!-- TODO : a modifier -->
                                    </p>
                                </li>

                                <!-- MENU FOOTER -->
                                <li class="user-footer">
                                    <div class="pull-left">
                                        <a class="btn btn-default btn-flat" href="#modal_profil" data-toggle="modal">Mon profil</a>
                                    </div>
                                    <div class="pull-right">
                                        <a href="{{path('polytech_dashboard_home_logout')}}" class="btn btn-default btn-flat">Déconnexion</a>
                                    </div>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>

        <!-- Debut modal view -->
        <div class="modal fade" id="modal_profil">
            <div class="modal-dialog">
                <div class="modal-content">
                    <!-- En tete -->
                    <div class="modal-header modal-header-task">
                        <button type="button" class="close" data-dismiss="modal">x</button>
                        <div class="modal-title">Mon profil</div>
                    </div>

                    <!-- Corps -->
                    <div class="modal-body">
                    <!--
                        <div style="margin: auto; text-align: center; max-height: 50px; max-width: 50px;">
                            <div class="row">
                                <div class="col-lg-6"></div>
                                     <img src="{{ asset('dist/img/user2-160x160.jpg')}}" class="user-image" alt="User Image"/>
                                </div>
                                <div class="col-lg-6">
                                    <span> {{prenom}} {{nom}}</span>
                                    <span>ET4 - Informatique</span>
                                </div>
                            </div>
                        </div>
                        -->
                        <div class="form-group">
                            <!-- Adresse mail -->
                            <div class="row">
                                <div class="col-lg-4">
                                    <label>Adresse e-mail : </label>
                                </div>
                                <div class="col-lg-8">
                                    <input type="text" class="form-control" value="mettre_adresse_mail@u-psud.fr" required>
                                </div>
                            </div>
                            <!-- Numero de telephone-->
                            <div class="row">
                                <div class="col-lg-4">
                                    <label>Numéro de téléphone : </label>
                                </div>
                                <div class="col-lg-8">
                                    <input type="text" class="form-control" value="" required>
                                </div>
                            </div>
                        </div>
                        Formulaire
                    </div>
                    <!-- Footer -->
                    <div class="modal-footer">
                        <button class="btn btn-primary" data-dismiss="modal">Enregistrer</button>
                        <button class="btn btn-primary" data-dismiss="modal">Fermer</button>
                    </div>
                </div>
            </div>
        </div>



        <!-- Left side column. contains the logo and sidebar -->
        <aside class="main-sidebar">
            {% include 'PolytechDashboardHomeBundle:Default:pages/sidebar.html.twig' %}
        </aside>

        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <div id="main_dashboard" style="display:block;">
                {% include 'PolytechDashboardHomeBundle:Default:pages/main_dashboard.html.twig' %}
            </div>
            <div id="my_space_study_level" style="display:none;">
                {% include 'PolytechDashboardHomeBundle:Default:pages/formation/my_space_study_level.html.twig' %}
            </div>
            <div id="my_program" style="display:none;">
                {% include 'PolytechDashboardHomeBundle:Default:pages/formation/my_program.html.twig' %}
            </div>
            <div id="my_tasks" style="display:none;">
                {% include 'PolytechDashboardHomeBundle:Default:pages/tasks/my_tasks.html.twig' %}
            </div>
            <div id="assign_task" style="display:none;">
                {% include 'PolytechDashboardHomeBundle:Default:pages/tasks/assign_task.html.twig' %}

            </div>
            <div id="my_grades" style="display:none;">
                {% include 'PolytechDashboardHomeBundle:Default:pages/my_grades.html.twig' %}

            </div>
            <div id="planning" style="display:none;">
                {% include 'PolytechDashboardHomeBundle:Default:pages/planning.html.twig' %}

            </div>
            <div id="my_notifications" style="display:none;">
                {% include 'PolytechDashboardHomeBundle:Default:pages/my_notifications.html.twig' %}

            </div>
            <div id="contact" style="display:none;">
                {% include 'PolytechDashboardHomeBundle:Default:pages/contact.html.twig' %}

            </div>
        </div>
        <!-- /.content-wrapper -->


        <footer class="main-footer">
            <strong>Copyright &copy; 2014-2015 </strong>  - Guillaume BLANCHARD, Cédric PORTANERI, Julien PREISNER, Yasser RABI   - All rights reserved.
        </footer>

    </div><!-- ./wrapper -->

{% endblock %}

{% block CustomFooterScript %}
    <script>
        var timer, delay = 10000;

        timer = setInterval(function(){
            $.ajax({
                type    : 'POST',
                url     : '/notificationList',
                dataType: 'json',
                data    : $('.ajaxform').serialize(),
                success : function(data){
                    if(data.length<=0){
                        //$("#nbNotification").css("display","none");
                        $("#nbNotification").html();
                        $("#textNbNotification").html("Vous n'avez pas de nouveaux notifications");
                    }else{
                        $("#nbNotification").html(data.length);
                        $("#textNbNotification").html("Vous avez "+data.length+" notifications");

                       // $("#nbNotification").css("display","block");

                    }
                    $("#NotificationContainer").html("<ul id=\"subNotificationContainer\" class=\"menu\"></ul>");
                    $.each(data, function(i, item) {
                        console.log(item.valeur);
                        console.log(item.categorie);


                        $("#subNotificationContainer").append(

                        "<li>"+
                        "<a href=\"#\">"+
                        "<i class=\"fa fa-warning text-yellow\"></i> " +
                        item.valeur+
                        "</a>" +
                        "</li>"
                        );


                    });
                }
            });
        }, delay);
    </script>
{% endblock %}
